{"cve": {"id": "CVE-2024-46682", "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67", "published": "2024-09-13T06:15:12.793", "lastModified": "2024-09-13T14:06:04.777", "vulnStatus": "Undergoing Analysis", "cveTags": [], "descriptions": [{"lang": "en", "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nnfsd: prevent panic for nfsv4.0 closed files in nfs4_show_open\n\nPrior to commit 3f29cc82a84c (\"nfsd: split sc_status out of\nsc_type\") states_show() relied on sc_type field to be of valid\ntype before calling into a subfunction to show content of a\nparticular stateid. From that commit, we split the validity of\nthe stateid into sc_status and no longer changed sc_type to 0\nwhile unhashing the stateid. This resulted in kernel oopsing\nfor nfsv4.0 opens that stay around and in nfs4_show_open()\nwould derefence sc_file which was NULL.\n\nInstead, for closed open stateids forgo displaying information\nthat relies of having a valid sc_file.\n\nTo reproduce: mount the server with 4.0, read and close\na file and then on the server cat /proc/fs/nfsd/clients/2/states\n\n[  513.590804] Call trace:\n[  513.590925]  _raw_spin_lock+0xcc/0x160\n[  513.591119]  nfs4_show_open+0x78/0x2c0 [nfsd]\n[  513.591412]  states_show+0x44c/0x488 [nfsd]\n[  513.591681]  seq_read_iter+0x5d8/0x760\n[  513.591896]  seq_read+0x188/0x208\n[  513.592075]  vfs_read+0x148/0x470\n[  513.592241]  ksys_read+0xcc/0x178"}, {"lang": "es", "value": "En el kernel de Linux, se ha resuelto la siguiente vulnerabilidad: nfsd: evitar p\u00e1nico para archivos cerrados nfsv4.0 en nfs4_show_open Antes del commit 3f29cc82a84c (\"nfsd: separar sc_status de sc_type\") states_show() depend\u00eda de que el campo sc_type fuera de un tipo v\u00e1lido antes de llamar a una subfunci\u00f3n para mostrar el contenido de un stateid en particular. A partir de esa confirmaci\u00f3n, dividimos la validez del stateid en sc_status y ya no cambiamos sc_type a 0 mientras deshacemos el hash del stateid. Esto result\u00f3 en un error del kernel para las aperturas nfsv4.0 que permanecen y en nfs4_show_open() se desreferenciaba sc_file que era NULL. En cambio, para los stateids abiertos y cerrados, renunciamos a mostrar informaci\u00f3n que depende de tener un sc_file v\u00e1lido. Para reproducir: monte el servidor con 4.0, lea y cierre un archivo y luego en el servidor cat /proc/fs/nfsd/clients/2/states [ 513.590804] Rastreo de llamadas: [ 513.590925] _raw_spin_lock+0xcc/0x160 [ 513.591119] nfs4_show_open+0x78/0x2c0 [nfsd] [ 513.591412] states_show+0x44c/0x488 [nfsd] [ 513.591681] seq_read_iter+0x5d8/0x760 [ 513.591896] seq_read+0x188/0x208 [ 513.592075] vfs_read+0x148/0x470 [513.592241] ksys_read+0xcc/0x178"}], "metrics": {}, "references": [{"url": "https://git.kernel.org/stable/c/a204501e1743d695ca2930ed25a2be9f8ced96d3", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, {"url": "https://git.kernel.org/stable/c/ba0b697de298285301c71c258598226e06494236", "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}]}}